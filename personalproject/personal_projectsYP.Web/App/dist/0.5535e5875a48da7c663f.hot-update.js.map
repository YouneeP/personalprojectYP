{"version":3,"file":"0.5535e5875a48da7c663f.hot-update.js","sources":["C:/sandbox/repos/personalprojectYP/personalproject/personal_projectsYP.Web/App/src/components/user.js"],"sourcesContent":["import React, { Component } from 'react';\r\nimport $ from 'jquery';\r\nimport { Button, Nav, Navbar, NavDropdown, MenuItem, NavItem, Grid, Row, Col} from 'react-bootstrap';\r\nimport registerform from '../img/registerpage.png';\r\n\r\nclass User extends Component {\r\n  constructor(props, context) {\r\n    super(props, context);\r\n    this.state = {\r\n      accountId:'',\r\n      meal:'',\r\n      quantity:'',\r\n      mealId:'',\r\n      user:[],\r\n      userMeal:[],\r\n      singleMeal:[],\r\n      mealArray:[],\r\n      nutritionArray:[],\r\n      viewNutrient:[],\r\n      editMode:false,\r\n      resultMode:false,\r\n      totalNutrition:[],\r\n      energy:0,\r\n      protein:0,\r\n      fat:0,\r\n      fattyAcid:0,\r\n      carbohydrates:0,\r\n      sugars:0,\r\n      sodium:0,\r\n      fibre:0\r\n    };\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.submit = this.submit.bind(this);\r\n    this.edit = this.edit.bind(this);\r\n    this.delete = this.delete.bind(this);\r\n    this.submitChange = this.submitChange.bind(this);\r\n    this.getCalculate = this.getCalculate.bind(this);\r\n    this.getnbdno = this.getnbdno.bind(this);\r\n    this.getNutrient = this.getNutrient.bind(this);\r\n    this.getNutrientView = this.getNutrientView.bind(this);\r\n  }\r\n\r\n  componentDidMount(){\r\n    let cookie = document.cookie;\r\n    if(cookie === null){\r\n      window.location.href = \"http://localhost:57432/login\"\r\n    }\r\n    else{\r\n      let accountId = cookie.split(\"=\")[1];\r\n      this.setState({\r\n        accountId:accountId\r\n      },()=>this.getByAccountId());\r\n    }\r\n  }\r\n\r\n  getByAccountId(){\r\n    let accountId = this.state.accountId;\r\n    fetch(\"/api/user/\"+accountId,{\r\n      method: 'GET',\r\n      headers:{'Content-Type':'application/json'},\r\n      credentials: 'include'\r\n    }).then((resp)=>resp.json())\r\n    .then(function(data){\r\n      let item = [data.Item];\r\n      this.setState({\r\n        user:item\r\n      },()=>this.getUserMeal())\r\n    }.bind(this))   \r\n  }\r\n\r\n  getUserMeal(){\r\n    let accountId = this.state.accountId;\r\n    fetch(\"/api/user/todaymeal/\"+accountId,{\r\n      method: 'GET',\r\n      headers:{'Content-Type':'application/json'},\r\n      credentials: 'include'\r\n    }).then((resp)=>resp.json())\r\n    .then(function(data){\r\n      let item = data.Items;\r\n        for(var i=0; i<item.length; i++){\r\n          item[i].CreatedDateOnly = item[i].CreatedDate.split(\"T\")[0];\r\n        }\r\n      this.setState({\r\n        userMeal:item\r\n      })\r\n    }.bind(this))   \r\n  }\r\n\r\n  handleChange(event) {\r\n    const target = event.target;\r\n    const value = target.value;\r\n    const name = target.name;\r\n    this.setState({\r\n        [name]: value\r\n    });\r\n  }\r\n\r\n  edit(id){\r\n    fetch(\"/api/user/singlemeal/\"+id,{\r\n      method: 'GET',\r\n      headers:{'Content-Type':'application/json'},\r\n      credentials: 'include'\r\n    }).then((resp)=>resp.json())\r\n    .then(function(data){\r\n      let item =data.Item;\r\n      this.setState({\r\n        accountId:item.AccountId,\r\n        meal:item.Meal,\r\n        mealId:item.Id,\r\n        quantity:item.Quantity,\r\n        editMode:true\r\n      })\r\n    }.bind(this)) \r\n  }\r\n\r\n  submitChange(){\r\n    let Id = this.state.mealId;\r\n    fetch(\"/api/user/update/\"+Id,{\r\n      method: 'PUT',\r\n      headers:{'Content-Type':'application/json'},\r\n      body:JSON.stringify({\r\n        Id: Id,\r\n        AccountId: this.state.accountId,\r\n        Meal:this.state.meal,\r\n        Quantity:this.state.quantity\r\n      }),\r\n      credentials: 'include'\r\n    })\r\n    .then(function(response){\r\n      this.setState({\r\n        nutritionArray:[],\r\n        meal:'',\r\n        quantity:'',\r\n        editMode:false\r\n      }, ()=>this.getUserMeal())\r\n    }.bind(this));\r\n  }\r\n\r\n  delete(id){\r\n    fetch(\"/api/user/delete/\"+id,{\r\n      method:'delete'\r\n    }).then(function(response){\r\n      this.setState({\r\n        nutritionArray:[],\r\n        editModel:false\r\n      }, ()=>this.getUserMeal())\r\n    }.bind(this));\r\n  }\r\n\r\n  submit(event){\r\n    event.preventDefault();\r\n    fetch(\"/api/user/meal\",{\r\n      method: 'POST',\r\n      headers: {'Content-Type':'application/json'},\r\n      body:JSON.stringify ({\r\n        AccountId:this.state.accountId,\r\n        Meal:this.state.meal,\r\n        Quantity:this.state.quantity\r\n      }),\r\n      credentials:'include'\r\n    })\r\n    .then(function(response){\r\n      this.setState({\r\n        nutritionArray:[],\r\n        meal:'',\r\n        quantity:''\r\n      },()=>this.getUserMeal())\r\n    }.bind(this));   \r\n  }\r\n\r\n  getCalculate(){\r\n    let userMeal = this.state.userMeal;\r\n    let foodArray=[];\r\n    for(var i=0; i<userMeal.length; i++){\r\n      foodArray.push(userMeal[i].Meal);\r\n    }\r\n    this.setState({foodArray:foodArray}, ()=>this.getnbdno(-1))\r\n  }\r\n\r\n  getnbdno(counter) {\r\n    let array=this.state.foodArray;\r\n    let length=array.length-1;\r\n    counter++;\r\n    fetch(\"https://api.nal.usda.gov/ndb/search/?format=json&q=\" +array[counter]+\"&sort=n&max=25&offset=0&api_key=iePhBf4DTI9UStixHQvpqeNZnlICZEKRITy2HpQV\",{\r\n    method: 'GET',\r\n    headers:{'Content-Type':'application/json'}\r\n    }).then((resp)=>resp.json())\r\n    .then(function(data){\r\n      if(data.list ==undefined){\r\n        return alert(\"Please Check Your Input\");\r\n      }\r\n      if(counter ===length){\r\n        let ndbno = data.list.item[0].ndbno;\r\n        this.getFinalNutrient(ndbno);\r\n        return;\r\n      }\r\n      else{\r\n        let ndbno = data.list.item[0].ndbno;\r\n        this.getNutrient(ndbno);\r\n        this.getnbdno(counter);\r\n      }\r\n    }.bind(this))\r\n  }\r\n\r\n  getNutrient(ndbno){\r\n    fetch(\"https://api.nal.usda.gov/ndb/reports/?ndbno=\"+ndbno+\"&type=b&format=json&api_key=iePhBf4DTI9UStixHQvpqeNZnlICZEKRITy2HpQV\",{\r\n      method: 'GET',\r\n      headers:{'Content-Type':'application/json'}\r\n    }).then((resp)=>resp.json()\r\n    .then(function(data){\r\n      let nutrientData = data.report.food;\r\n      var nutritionArray = [...this.state.nutritionArray];\r\n      nutritionArray.push(nutrientData);\r\n      this.setState({nutritionArray:nutritionArray})\r\n    }.bind(this)))\r\n  }\r\n\r\n  getFinalNutrient(ndbno){\r\n    fetch(\"https://api.nal.usda.gov/ndb/reports/?ndbno=\"+ndbno+\"&type=b&format=json&api_key=iePhBf4DTI9UStixHQvpqeNZnlICZEKRITy2HpQV\",{\r\n      method: 'GET',\r\n      headers:{'Content-Type':'application/json'}\r\n    }).then((resp)=>resp.json()\r\n    .then(function(data){\r\n      let nutrientData = data.report.food;\r\n      var nutritionArray = [...this.state.nutritionArray];\r\n      nutritionArray.push(nutrientData);\r\n      this.setState({nutritionArray:nutritionArray},()=>this.getNutrientView())\r\n    }.bind(this)))\r\n  }\r\n\r\n  getNutrientView(){\r\n    let nutArr = this.state.nutritionArray;\r\n    let aggValues=[];\r\n    for(var i=0; i<nutArr.length; i++){\r\n      for(var j=0; j<nutArr[i].nutrients.length; j++){\r\n        var singleVal = nutArr[i].nutrients[j];\r\n        var oldVal = aggValues.find((e) => e.nutrient_id ==singleVal.nutrient_id);\r\n        if(oldVal){\r\n          oldVal.value =parseInt(oldVal.value) +parseInt(singleVal.value);\r\n        }\r\n        else{\r\n          aggValues.push(singleVal);\r\n        }\r\n      }\r\n    }\r\n    for(var y=0; y<aggValues.length; y++){\r\n      if(aggValues[y].nutrient_id==\"208\"){\r\n       //console.log(\"Energy:\"+ aggValues[y].value +\"kcal\");\r\n        var Energy = parseInt(aggValues[y].value);\r\n      }\r\n      else if(aggValues[y].nutrient_id==\"203\"){\r\n        //console.log(\"Protein:\" + aggValues[y].value+\"g\");\r\n        var Protein = parseInt(aggValues[y].value);\r\n      }\r\n      else if(aggValues[y].nutrient_id==\"204\"){\r\n        //console.log(\"Fat:\" + aggValues[y].value+\"g\");\r\n        var Fat = parseInt(aggValues[y].value);\r\n      }\r\n      else if(aggValues[y].nutrient_id==\"606\"){\r\n        //console.log(\"Saturated Fatty Acids:\" + aggValues[y].value+\"g\");\r\n        var FattyAcid = parseInt(aggValues[y].value);\r\n      }\r\n      else if(aggValues[y].nutrient_id==\"205\"){\r\n        //console.log(\"Carbohydrates:\" + aggValues[y].value+\"g\");\r\n        var Carbohydrates = parseInt(aggValues[y].value);\r\n      }\r\n      else if(aggValues[y].nutrient_id==\"269\"){\r\n        //console.log(\"Sugars:\" + aggValues[y].value + \"g\");\r\n        var Sugars = parseInt(aggValues[y].value);\r\n      }\r\n      else if(aggValues[y].nutrient_id==\"307\"){\r\n        //console.log(\"Sodium:\" + aggValues[y].value + \"mg\");\r\n        var Sodium = (parseInt(aggValues[y].value))/1000;       \r\n      }\r\n      else if(aggValues[y].nutrient_id==\"291\"){\r\n        //console.log(\"Dietary Fibre:\" + aggValues[y].value+\"g\");\r\n        var Fibre = parseInt(aggValues[y].value);\r\n      }\r\n    }\r\n    this.setState({\r\n      engergy:Energy,\r\n      protein:Protein,\r\n      fat:Fat,\r\n      fattyAcid:FattyAcid,\r\n      carbohydrates:Carbohydrates,\r\n      sugars:Sugars,\r\n      sodium:Sodium,\r\n      fibre:Fibre,\r\n      resultMode:true\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className=\"row\">\r\n          <div className=\"col-md-4 m-t-sm m-l-md\" >\r\n            <div className=\"card askForm\">\r\n              <img className=\"card-img-top img-responsive m-b-sm\" src={registerform} />\r\n              <div className=\"card-body\">\r\n                <form className=\"form-group\" onSubmit={this.submit}> \r\n                  <label>What have you eat today?</label>\r\n                      <input type=\"text\" onChange={this.handleChange} className=\"form-control m-b-sm\" name=\"meal\" value={this.state.meal} />\r\n                  <label>Quantity</label>\r\n                      <input type=\"number\" onChange={this.handleChange} className=\"form-control m-b-sm\" name=\"quantity\" value={this.state.quantity} />\r\n                  {this.state.editMode === true ? \r\n                  <div>\r\n                    <button type=\"button\" onClick={this.submitChange} className=\"btn btn-secondary btn-lg btn-block m-t-md\">Edit</button>\r\n                  </div>\r\n                  : \r\n                  <button type=\"submit\" className=\"btn btn-primary btn-lg btn-block m-t-md\">Submit</button>}\r\n                  \r\n                </form>\r\n              </div>\r\n            </div>\r\n          </div>\r\n            {this.state.user.map( user =>\r\n              <div className=\"col-md-4 m-t-sm\" key={user.Id}>\r\n                <div className=\"card mealList\">\r\n                  <div className=\"card-header bg-dark text-white\">\r\n                    Today, {user.FirstName} {user.LastName} Ate ...\r\n                  </div>\r\n                  <div className=\"card-body\">\r\n                    {this.state.userMeal.map (userMeal =>\r\n                      <div key={userMeal.Id}>\r\n                        <div className=\"row\">\r\n                          <button \r\n                            type=\"button\" \r\n                            onClick={()=>this.edit(userMeal.Id)} \r\n                            className=\"btn btn-outline-secondary m-l-sm m-b-xs\"\r\n                          >{userMeal.Meal} x {userMeal.Quantity}</button>\r\n                          <i className=\"fa fa-close m-l-xs\" onClick={ ()=>this.delete(userMeal.Id)} />\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                    <button type=\"button\" className=\"btn btn-primary m-t-md\" onClick={this.getCalculate}>Calculate</button>\r\n                  </div>\r\n                </div>\r\n                {this.state.resultMode === true ? \r\n                  <div className=\"result m-t-sm\">\r\n                    <div className=\"card\">\r\n                      <div className=\"card-header  bg-dark text-white\">\r\n                        You Ate ...\r\n                      </div>\r\n                      <div className=\"card-body\">\r\n                        Energy: {this.state.energy}<br/>\r\n                        Protein: {this.state.protein} g<br/>\r\n                        Fat: {this.state.fat} g<br/>\r\n                        Saturated Fatty Acids: {this.state.fattyAcid} g <br/>\r\n                        Carbohydrates: {this.state.carbohydrates} g<br/>\r\n                        Sugars: {this.state.sugars} g<br/>\r\n                        Sodium: {this.state.sodium} g<br/>\r\n                      </div>\r\n                  </div>\r\n                </div>\r\n                : null}\r\n              </div>\r\n            )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default User;\n\n\n// WEBPACK FOOTER //\n// src/components/user.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArBA;AAuBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjCA;AAkCA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AADA;AAEA;AAAA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAHA;AAIA;AAAA;AACA;AACA;AAAA;AACA;AACA;AADA;AAEA;AAAA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAHA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AAGA;;;AAEA;AACA;AACA;AACA;AACA;AAHA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AATA;AAWA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAKA;AAAA;AACA;AACA;;;AAEA;AACA;AACA;AADA;AAEA;AACA;AAAA;AACA;AACA;AAFA;AAGA;AAAA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AARA;AAUA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAIA;AAAA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAGA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AAFA;AAGA;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","sourceRoot":""}